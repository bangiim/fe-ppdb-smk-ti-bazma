document.getElementById('select-tahun-pelajaran').addEventListener('change', validateField);
document.getElementById('nik').addEventListener('input', validateField);
document.getElementById('nisn').addEventListener('input', validateField);
document.getElementById('nama_lengkap').addEventListener('input', validateField);
document.getElementById('tempat_lahir').addEventListener('input', validateField);
document.getElementById('tanggal_lahir').addEventListener('input', validateField);
document.getElementById('alamat').addEventListener('input', validateField);
document.getElementById('select-provinsi').addEventListener('input', validateField);
document.getElementById('kota_kabupaten').addEventListener('input', validateField);
document.getElementById('no_whatsapp_telp').addEventListener('input', validateField);
document.getElementById('sosial_media').addEventListener('input', validateField);
document.getElementById('smp_derajat').addEventListener('input', validateField);
document.getElementById('npsn').addEventListener('input', validateField);
document.getElementById('select-tahun-lulus').addEventListener('change', validateField);
document.getElementById('anak_ke_sodara').addEventListener('input', validateField);
document.getElementById('select-keadaan-ortu').addEventListener('change', validateField);
document.getElementById('select-status-dalam-keluarga').addEventListener('change', validateField);
document.getElementById('select-tinggal-bersama').addEventListener('change', validateField);
document.getElementById('select-penerima-bansos').addEventListener('change', validateField);
document.getElementById('rapor_matematika_3').addEventListener('input', validateField);
document.getElementById('rapor_matematika_4').addEventListener('input', validateField);
document.getElementById('rapor_matematika_5').addEventListener('input', validateField);
document.getElementById('rapor_ipa_3').addEventListener('input', validateField);
document.getElementById('rapor_ipa_4').addEventListener('input', validateField);
document.getElementById('rapor_ipa_5').addEventListener('input', validateField);
document.getElementById('rapor_indo_3').addEventListener('input', validateField);
document.getElementById('rapor_indo_4').addEventListener('input', validateField);
document.getElementById('rapor_indo_5').addEventListener('input', validateField);
document.getElementById('rapor_inggris_3').addEventListener('input', validateField);
document.getElementById('rapor_inggris_4').addEventListener('input', validateField);
document.getElementById('rapor_inggris_5').addEventListener('input', validateField);
document.getElementById('rapor_islam_3').addEventListener('input', validateField);
document.getElementById('rapor_islam_4').addEventListener('input', validateField);
document.getElementById('rapor_islam_5').addEventListener('input', validateField);
document.getElementById('bahasa_asing').addEventListener('input', validateField);
document.getElementById('jumlah_hafalan_juz').addEventListener('input', validateField);
document.getElementById('hafalan_juz').addEventListener('input', validateField);
document.getElementById('riwayat_prestasi_calon_peserta_didik').addEventListener('input', validateField);
document.getElementById('riwayat_organisasi_sekolah_dan_non_sekolah').addEventListener('input', validateField);
document.getElementById('hal_hal_khusus').addEventListener('input', validateField);
document.getElementById('cita_cita').addEventListener('input', validateField);
document.getElementById('hobi_kegemaran').addEventListener('input', validateField);
document.getElementById('nama_ayah_kandung').addEventListener('input', validateField);
document.getElementById('pekerjaan_ayah_kandung').addEventListener('input', validateField);
document.getElementById('penghasilan_pokok_pensiunan_ayah').addEventListener('input', validateField);
document.getElementById('select-pendidikan-ayah').addEventListener('change', validateField);
document.getElementById('pendapatan_diluar_penghasilan_perbulan_ayah').addEventListener('input', validateField);
document.getElementById('domisili_ayah_kandung').addEventListener('input', validateField);
document.getElementById('domisili_ayah_kandung').addEventListener('input', validateField);
document.getElementById('no_whatsapp_ayah_kandung').addEventListener('input', validateField);
document.getElementById('nama_ibu_kandung').addEventListener('input', validateField);
document.getElementById('select-pendidikan-ibu').addEventListener('change', validateField);
document.getElementById('pekerjaan_ibu_kandung').addEventListener('input', validateField);
document.getElementById('penghasilan_pokok_pensiunan_ibu').addEventListener('input', validateField);
document.getElementById('pendapatan_diluar_penghasilan_perbulan_ibu').addEventListener('input', validateField);
document.getElementById('domisili_ibu_kandung').addEventListener('input', validateField);
document.getElementById('no_whatsapp_ibu_kandung').addEventListener('input', validateField);
document.getElementById('jumlah_tanggungan_dalam_keluarga').addEventListener('input', validateField);
document.getElementById('harapan_orang_tua').addEventListener('input', validateField);
document.getElementById('nama_wali').addEventListener('input', validateField);
document.getElementById('pekerjaan_wali').addEventListener('input', validateField);
document.getElementById('penghasilan_wali').addEventListener('input', validateField);
document.getElementById('alamat_domisili_wali').addEventListener('input', validateField);
document.getElementById('hubungan_wali').addEventListener('input', validateField);
document.getElementById('email_id').addEventListener('input', validateField);
document.getElementById('select-sumber-penghasilan').addEventListener('change', validateField);
document.getElementById('nama_fasilitator').addEventListener('input', validateField);
document.getElementById('hubungan_calon_siswa_fasilitator').addEventListener('input', validateField);
document.getElementById('no_whatsapp_fasilitator').addEventListener('input', validateField);
document.getElementById('email_fasilitator').addEventListener('input', validateField);
document.getElementById('select-informasi-ppdb').addEventListener('change', validateField);
document.getElementById('saudara_beasiswa_di_smk_fasilitator').addEventListener('change', validateField);
document.getElementById('select-kepemilikan-rumah').addEventListener('change', validateField);
document.getElementById('tahun_perolehan_status_kepemilikan').addEventListener('change', validateField);
document.getElementById('select-kualitas-rumah').addEventListener('change', validateField);
document.getElementById('select-luas-tanah').addEventListener('change', validateField);
document.getElementById('select-mandi-cuci-kakus').addEventListener('change', validateField);
document.getElementById('select-sumber-air').addEventListener('change', validateField);
document.getElementById('select-daya-listrik').addEventListener('change', validateField);
document.getElementById('select-harta-tidak-bergerak').addEventListener('change', validateField);
document.getElementById('select-status-harta-tidak-bergerak').addEventListener('change', validateField);
document.getElementById('select-kepemilikan-kendaraan').addEventListener('change', validateField);
document.getElementById('select-status-kepemilikan-kendaraan').addEventListener('change', validateField);
document.getElementById('tinggi_badan').addEventListener('input', validateField);
document.getElementById('berat_badan').addEventListener('input', validateField);
document.getElementById('select-golongan-darah').addEventListener('change', validateField);
document.getElementById('penyakit_di_derita').addEventListener('input', validateField);
document.getElementById('penyakit_menular').addEventListener('input', validateField);
document.getElementById('perokok').addEventListener('change', validateField);
document.getElementById('buta_warna').addEventListener('change', validateField);
document.getElementById('asuransi_bpjs_kis').addEventListener('change', validateField);
document.getElementById('scan_bpjs_kis').addEventListener('change', validateFileUpload);
document.getElementById('kartu_keluarga').addEventListener('change', validateFileUpload);
document.getElementById('pas_foto').addEventListener('change', validateFileUpload);
document.getElementById('sktm').addEventListener('change', validateFileUpload);
document.getElementById('upload_surat_rekomendasi').addEventListener('change', validateFileUpload);
document.getElementById('upload_pdf_foto_rumah').addEventListener('change', validateFileUpload);
document.getElementById('essay_karangan').addEventListener('change', validateFileUpload);
document.getElementById('rangkaian_tes').addEventListener('change', validateField);
document.getElementById('fcustomCheck1').addEventListener('change', validateField);
document.getElementById('pelanggaran_keputusan').addEventListener('change', validateField)


function validateNumericInput(event, fieldName) {
    const errorElement = document.getElementById(`error-${fieldName}`);
    const inputValue = event.target.value;

    const numericValue = inputValue.replace(/\D/g, '');

    event.target.value = numericValue;

    if (numericValue !== inputValue) {
        if (errorElement) {
            errorElement.innerHTML = `<small><i>${fieldName.replace('_', ' ')} Hanya di perbolehkan angka saja.</i></small>`;
        }
    } else {
        if (errorElement) {
            errorElement.innerHTML = '';
        }
    }
}

async function postData() {
    const formData = new FormData(document.getElementById('formRegis'));
    const apiUrl = "https://api.ppdb.smktibazma.sch.id/api/v1/public/daftar-peserta";

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            body: formData,
            cache: "no-cache",
        });

        if (response.ok) {
            Swal.fire({
                icon: 'success',
                title: 'Success',
                text: 'Data Berhasil Terkirim',
            }).then((result) => {
                if (result.isConfirmed || result.dismiss === Swal.DismissReason.backdrop) {
                    // Clear error messages
                    clearErrorMessages();
                    window.location.reload();
                }
            });
        } else {
            const errorData = await response.json();
            handleErrors(errorData.errors);
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

// function validateField(event) {
//     const fieldName = event.target.name;
//     const errorElement = document.getElementById(`error-${fieldName}`);
//     if (event.target.value.trim() === '') {
//         if (errorElement) {
//             errorElement.innerHTML = `<small><i>${fieldName.replace('_', ' ')} is required.</i></small>`;
//         }
//     } else {
//         if (errorElement) {
//             errorElement.innerHTML = ''; // Clear error message if the field is not empty
//         }
//     }
// }

function validateFileUpload(event) {
    const fieldName = event.target.getAttribute('id');
    const errorElement = document.getElementById(`error-${fieldName}`);

    if (event.target.files.length > 0) {
        if (errorElement) {
            errorElement.innerHTML = '';
        }

        const uploadedFile = event.target.files[0];
        // console.log('Uploaded File:', uploadedFile);

    } else {
        if (errorElement) {
            errorElement.innerHTML = `<small><i>${fieldName.replace('_', ' ')} must be uploaded.</i></small>`;
        }
    }
}
function validateField(event) {
    const fieldName = event.target.name;

    if (fieldName === 'scan_bpjs_kis' || fieldName === 'kartu_keluarga' || fieldName === 'pas_foto' || fieldName === 'sktm' || fieldName === 'upload_surat_rekomendasi' || fieldName === 'upload_pdf_foto_rumah' || fieldName === 'essay_karangan') {
        validateFileUpload(event);
    }

    const errorElement = document.getElementById(`error-${fieldName}`);
    if (event.target.value.trim() === '') {
        if (errorElement) {
            errorElement.innerHTML = `<small><i>${fieldName.replace('_', ' ')} is required.</i></small>`;
        }
    } else {
        if (errorElement) {
            errorElement.innerHTML = '';
        }
    }
}

function handleErrors(errors) {
    Object.keys(errors).forEach((fieldName) => {
        const errorElement = document.getElementById(`error-${fieldName}`);

        if (errorElement) {
            const errorMessage = `<small><i>${errors[fieldName][0]}</i></small>`;
            errorElement.innerHTML = errorMessage;
        } else {
            console.error(`Elemen dengan ID 'error-${fieldName}' tidak ditemukan.`);
        }
    });
}

function clearErrorMessages() {
    const errorElements = document.querySelectorAll('[id^="error-"]');
    errorElements.forEach((element) => {
        element.innerHTML = '';
    });
}
